# gocov - Goã‚«ãƒãƒ¬ãƒƒã‚¸é›†è¨ˆãƒ„ãƒ¼ãƒ«

## æ¦‚è¦

`gocov`ã¯ã€Goãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã§é›†è¨ˆãƒ»è¡¨ç¤ºã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æ¨™æº–ã®`go test`ã§ç”Ÿæˆã•ã‚ŒãŸã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã‚’è¦‹ã‚„ã™ã„è¡¨å½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚

## ç‰¹å¾´

- ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸é›†è¨ˆ
- ğŸ¯ æŸ”è»Ÿãªéšå±¤ãƒ¬ãƒ™ãƒ«ã§ã®é›†è¨ˆãŒå¯èƒ½
- ğŸ” ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã«ã‚ˆã‚‹çµæœã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
- ğŸ“Š è¦‹ã‚„ã™ã„è¡¨å½¢å¼ã§ã®çµæœè¡¨ç¤º
- ğŸš€ ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ğŸ”§ æ¨™æº–ã®Goã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã«å¯¾å¿œ

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
go install github.com/blck-snwmn/gocov@latest
```

ã¾ãŸã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ï¼š

```bash
git clone https://github.com/blck-snwmn/gocov.git
cd gocov
go build -o gocov
```

## ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

1. ã¾ãšã€Goãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ï¼š

```bash
go test -coverprofile=coverage.out -coverpkg=./... ./...
```

2. `gocov`ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ï¼š

```bash
gocov -coverprofile=coverage.out
```

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `-coverprofile`: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼ˆå¿…é ˆï¼‰
- `-level`: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªéšå±¤ã®é›†è¨ˆãƒ¬ãƒ™ãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰
  - `0`: æœ«ç«¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ã«é›†è¨ˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  - `N` (N > 0): ãƒ‘ã‚¹ã®æœ€åˆã®Nå€‹ã®è¦ç´ ã§é›†è¨ˆ
  - `-1`: ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§å…¨ä½“ã‚’é›†è¨ˆ
- `-min`: è¡¨ç¤ºã™ã‚‹æœ€å°ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆ0-100ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰
- `-max`: è¡¨ç¤ºã™ã‚‹æœ€å¤§ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆ0-100ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100ï¼‰
- `-format`: å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆtable ã¾ãŸã¯ jsonã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: tableï¼‰
- `-ignore`: ç„¡è¦–ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒªã‚¹ãƒˆï¼ˆãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰å¯¾å¿œï¼‰

### å‡ºåŠ›ä¾‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæœ«ç«¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ï¼‰:
```
$ gocov -coverprofile=coverage.out
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd/server                      7          5   71.4%
github.com/example/project/internal/service                7          6   85.7%
github.com/example/project/pkg/util                        7          5   71.4%
--------------------------------------------------------------------------------
TOTAL                                                     21         16   76.2%
```

ãƒ¬ãƒ™ãƒ«4ã§é›†è¨ˆï¼ˆpkg, cmd, internalå˜ä½ï¼‰:
```
$ gocov -coverprofile=coverage.out -level 4
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd                             7          5   71.4%
github.com/example/project/internal                        7          6   85.7%
github.com/example/project/pkg                             7          5   71.4%
--------------------------------------------------------------------------------
TOTAL                                                     21         16   76.2%
```

ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§é›†è¨ˆ:
```
$ gocov -coverprofile=coverage.out -level -1
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
.                                                         21         16   76.2%
--------------------------------------------------------------------------------
TOTAL                                                     21         16   76.2%
```

æœ€å°ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆ75%ä»¥ä¸Šã®ã¿è¡¨ç¤ºï¼‰:
```
$ gocov -coverprofile=coverage.out -min 75
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/internal/service                7          6   85.7%
--------------------------------------------------------------------------------
FILTERED TOTAL                                              7          6   85.7%
TOTAL                                                     21         16   76.2%
```

æœ€å¤§ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆ75%ä»¥ä¸‹ã®ã¿è¡¨ç¤ºï¼‰:
```
$ gocov -coverprofile=coverage.out -max 75
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd/server                      7          5   71.4%
github.com/example/project/pkg/util                        7          5   71.4%
--------------------------------------------------------------------------------
FILTERED TOTAL                                             14         10   71.4%
TOTAL                                                     21         16   76.2%
```

JSONå½¢å¼ã§ã®å‡ºåŠ›:
```
$ gocov -coverprofile=coverage.out -format json -min 75
{
  "results": [
    {
      "directory": "github.com/example/project/internal/service",
      "statements": 7,
      "covered": 6,
      "coverage": 85.71428571428571
    }
  ],
  "total": {
    "directory": "TOTAL",
    "statements": 21,
    "covered": 16,
    "coverage": 76.19047619047619
  },
  "filtered_total": {
    "directory": "FILTERED TOTAL",
    "statements": 7,
    "covered": 6,
    "coverage": 85.71428571428571
  }
}
```

ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç„¡è¦–ã—ã¦é›†è¨ˆ:
```
$ gocov -coverprofile=coverage.out -ignore "*/internal/*,*/vendor/*"
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd/server                      7          5   71.4%
github.com/example/project/pkg/util                        7          5   71.4%
--------------------------------------------------------------------------------
TOTAL                                                     14         10   71.4%
```

## å‹•ä½œåŸç†

`gocov`ã¯ä»¥ä¸‹ã®æ‰‹é †ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é›†è¨ˆã—ã¾ã™ï¼š

1. æŒ‡å®šã•ã‚ŒãŸã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ
2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ãƒãƒ¬ãƒƒã‚¸æƒ…å ±ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã§é›†è¨ˆ
3. ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆæ•°ã¨ã‚«ãƒãƒ¼ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆæ•°ã‚’è¨ˆç®—
4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã‚’ç®—å‡º
5. çµæœã‚’è¡¨å½¢å¼ã§å‡ºåŠ›

## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

- å¤§è¦æ¨¡ãªGoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç®¡ç†
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆJSONå‡ºåŠ›ã‚’æ´»ç”¨ï¼‰
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ã®ãƒ†ã‚¹ãƒˆå“è³ªã®å¯è¦–åŒ–
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä½ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç‰¹å®šï¼ˆ-minãƒ•ãƒ©ã‚°ã‚’æ´»ç”¨ï¼‰
- ãƒ†ã‚¹ãƒˆã‚„vendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é™¤å¤–ã—ãŸã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æï¼ˆ-ignoreãƒ•ãƒ©ã‚°ã‚’æ´»ç”¨ï¼‰

## åˆ¶é™äº‹é …

- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯äº‹å‰ã«ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- å‡ºåŠ›å…ˆã¯æ¨™æº–å‡ºåŠ›ã®ã¿ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ä¿å­˜å¯èƒ½ï¼‰

## å¿…è¦è¦ä»¶

- Go 1.16ä»¥ä¸Š
- `golang.org/x/tools/cover`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸