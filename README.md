# gocov - Goã‚«ãƒãƒ¬ãƒƒã‚¸é›†è¨ˆãƒ„ãƒ¼ãƒ«

[![Test](https://github.com/blck-snwmn/gocov/actions/workflows/test.yml/badge.svg)](https://github.com/blck-snwmn/gocov/actions/workflows/test.yml)

## æ¦‚è¦

`gocov`ã¯ã€Goãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã§é›†è¨ˆãƒ»è¡¨ç¤ºã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æ¨™æº–ã®`go test`ã§ç”Ÿæˆã•ã‚ŒãŸã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã‚’è¦‹ã‚„ã™ã„è¡¨å½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚

## ç‰¹å¾´

- ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸é›†è¨ˆ
- ğŸ¯ æŸ”è»Ÿãªéšå±¤ãƒ¬ãƒ™ãƒ«ã§ã®é›†è¨ˆãŒå¯èƒ½
- ğŸ” ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã«ã‚ˆã‚‹çµæœã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
- ğŸ“Š è¦‹ã‚„ã™ã„è¡¨å½¢å¼ã§ã®çµæœè¡¨ç¤º
- ğŸš€ ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ğŸ”§ æ¨™æº–ã®Goã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã«å¯¾å¿œ
- âš™ï¸ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã®è¨­å®šç®¡ç†
- âš¡ å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ã®ä¸¦è¡Œå‡¦ç†ã‚µãƒãƒ¼ãƒˆ
- ğŸ¯ å·®åˆ†ã‚«ãƒãƒ¬ãƒƒã‚¸æ©Ÿèƒ½ï¼ˆå¤‰æ›´è¡Œã®ã¿ã®ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆç®—ï¼‰
- âœ… CIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‘ã‘ã®ã—ãã„å€¤ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
go install github.com/blck-snwmn/gocov@latest
```

ã¾ãŸã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ï¼š

```bash
git clone https://github.com/blck-snwmn/gocov.git
cd gocov
go build -o gocov
```

## ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

1. ã¾ãšã€Goãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ï¼š

```bash
go test -coverprofile=coverage.out -coverpkg=./... ./...
```

2. `gocov`ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ï¼š

```bash
gocov -coverprofile=coverage.out
```

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `-coverprofile`: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼ˆå¿…é ˆï¼‰
- `-level`: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªéšå±¤ã®é›†è¨ˆãƒ¬ãƒ™ãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰
  - `0`: æœ«ç«¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ã«é›†è¨ˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  - `N` (N > 0): ãƒ‘ã‚¹ã®æœ€åˆã®Nå€‹ã®è¦ç´ ã§é›†è¨ˆ
  - `-1`: ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§å…¨ä½“ã‚’é›†è¨ˆ
- `-min`: è¡¨ç¤ºã™ã‚‹æœ€å°ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆ0-100ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰
- `-max`: è¡¨ç¤ºã™ã‚‹æœ€å¤§ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ï¼ˆ0-100ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100ï¼‰
- `-format`: å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆtable ã¾ãŸã¯ jsonã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: tableï¼‰
- `-ignore`: ç„¡è¦–ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒªã‚¹ãƒˆï¼ˆãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰å¯¾å¿œï¼‰
- `-concurrent`: å¤§ããªã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ä¸¦è¡Œå‡¦ç†ã‚’ä½¿ç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰
- `-config`: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ä¸Šä½ã«å‘ã‹ã£ã¦`.gocov.yml`ã‚’æ¤œç´¢ï¼‰
- `-threshold`: æœ€å°ç·ã‚«ãƒãƒ¬ãƒƒã‚¸ã—ãã„å€¤ï¼ˆ0-100ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰
- `-diff`: å·®åˆ†ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆå¤‰æ›´è¡Œã®ã¿ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¡¨ç¤ºï¼‰

### å‡ºåŠ›ä¾‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæœ«ç«¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ï¼‰:
```
$ gocov -coverprofile=coverage.out
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd/server                      7          5   71.4%
github.com/example/project/internal/service                7          6   85.7%
github.com/example/project/pkg/util                        7          5   71.4%
--------------------------------------------------------------------------------
TOTAL                                                     21         16   76.2%
```

ãƒ¬ãƒ™ãƒ«4ã§é›†è¨ˆï¼ˆpkg, cmd, internalå˜ä½ï¼‰:
```
$ gocov -coverprofile=coverage.out -level 4
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd                             7          5   71.4%
github.com/example/project/internal                        7          6   85.7%
github.com/example/project/pkg                             7          5   71.4%
--------------------------------------------------------------------------------
TOTAL                                                     21         16   76.2%
```

ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§é›†è¨ˆ:
```
$ gocov -coverprofile=coverage.out -level -1
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
.                                                         21         16   76.2%
--------------------------------------------------------------------------------
TOTAL                                                     21         16   76.2%
```

æœ€å°ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆ75%ä»¥ä¸Šã®ã¿è¡¨ç¤ºï¼‰:
```
$ gocov -coverprofile=coverage.out -min 75
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/internal/service                7          6   85.7%
--------------------------------------------------------------------------------
FILTERED TOTAL                                              7          6   85.7%
TOTAL                                                     21         16   76.2%
```

æœ€å¤§ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆ75%ä»¥ä¸‹ã®ã¿è¡¨ç¤ºï¼‰:
```
$ gocov -coverprofile=coverage.out -max 75
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd/server                      7          5   71.4%
github.com/example/project/pkg/util                        7          5   71.4%
--------------------------------------------------------------------------------
FILTERED TOTAL                                             14         10   71.4%
TOTAL                                                     21         16   76.2%
```

JSONå½¢å¼ã§ã®å‡ºåŠ›:
```
$ gocov -coverprofile=coverage.out -format json -min 75
{
  "results": [
    {
      "directory": "github.com/example/project/internal/service",
      "statements": 7,
      "covered": 6,
      "coverage": 85.71428571428571
    }
  ],
  "total": {
    "directory": "TOTAL",
    "statements": 21,
    "covered": 16,
    "coverage": 76.19047619047619
  },
  "filtered_total": {
    "directory": "FILTERED TOTAL",
    "statements": 7,
    "covered": 6,
    "coverage": 85.71428571428571
  }
}
```

ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç„¡è¦–ã—ã¦é›†è¨ˆ:
```
$ gocov -coverprofile=coverage.out -ignore "*/internal/*,*/vendor/*"
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd/server                      7          5   71.4%
github.com/example/project/pkg/util                        7          5   71.4%
--------------------------------------------------------------------------------
TOTAL                                                     14         10   71.4%
```

ã‚«ãƒãƒ¬ãƒƒã‚¸ã—ãã„å€¤ãƒã‚§ãƒƒã‚¯ï¼ˆCIã§ã®ä½¿ç”¨ã«æœ€é©ï¼‰:
```
$ gocov -coverprofile=coverage.out -threshold 80
Directory                                          Statements    Covered Coverage
--------------------------------------------------------------------------------
github.com/example/project/cmd/server                      7          5   71.4%
github.com/example/project/internal/service                7          6   85.7%
github.com/example/project/pkg/util                        7          5   71.4%
--------------------------------------------------------------------------------
TOTAL                                                     21         16   76.2%
2025/05/25 15:00:00 coverage 76.2% is below threshold 80.0%
# Exit code: 1
```

å·®åˆ†ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆå¤‰æ›´è¡Œã®ã¿ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¡¨ç¤ºï¼‰:
```
$ gocov -coverprofile=coverage.out -diff HEAD~1
Diff Coverage Report:
================================================================================
File                                                    Lines    Covered Coverage
--------------------------------------------------------------------------------
internal/service/user.go                                   45         38    84.4%
  Uncovered lines: [23 24 67 89 90]
internal/api/handler.go                                    23         12    52.2%
  Uncovered lines: [45 46 47 48 49 50 78 79 80 81]... (1 more)
pkg/utils/validator.go                                     15         15   100.0%
--------------------------------------------------------------------------------
TOTAL DIFF                                                 83         65    78.3%
```

å·®åˆ†ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¢ãƒ¼ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
- `HEAD~1`: å‰ã®ã‚³ãƒŸãƒƒãƒˆã¨ã®å·®åˆ†
- `main` ã¾ãŸã¯ `master`: ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã¨ã®å·®åˆ†
- `staged` ã¾ãŸã¯ `cached`: ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚¨ãƒªã‚¢ã®å¤‰æ›´
- `working` ã¾ãŸã¯ `unstaged`: ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¤‰æ›´
- ãã®ä»–ã®ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã‚„ãƒ–ãƒ©ãƒ³ãƒåã‚‚æŒ‡å®šå¯èƒ½

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

`gocov`ã¯`.gocov.yml`ã¨ã„ã†è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã®è¨­å®šã‚’æ°¸ç¶šåŒ–ã—ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç°¡ç•¥åŒ–ã§ãã¾ã™ã€‚

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢é †åº

1. `-config`ãƒ•ãƒ©ã‚°ã§æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹
2. ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‘ã‹ã£ã¦`.gocov.yml`ã‚’æ¤œç´¢

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹

```yaml
# gocov configuration file

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªéšå±¤ã®é›†è¨ˆãƒ¬ãƒ™ãƒ«
level: 0

# ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
coverage:
  min: 0
  max: 100

# å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
format: table

# ç„¡è¦–ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³
ignore:
  - "*/vendor/*"
  - "*/test/*"
  - "*/mock/*"
  - "*/generated/*"

# ä¸¦è¡Œå‡¦ç†ã®æœ‰åŠ¹åŒ–
concurrent: true

# ã‚«ãƒãƒ¬ãƒƒã‚¸ã—ãã„å€¤ï¼ˆCIã§ã®ä½¿ç”¨ã«æœ€é©ï¼‰
threshold: 80
```

### å„ªå…ˆé †ä½

ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å¸¸ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å€¤ã‚’ä¸Šæ›¸ãã—ã¾ã™ã€‚ä¾‹ï¼š

```bash
# .gocov.ymlã§format: tableãŒè¨­å®šã•ã‚Œã¦ã„ã¦ã‚‚ã€JSONã§å‡ºåŠ›ã•ã‚Œã‚‹
gocov -coverprofile=coverage.out -format json
```

## å‹•ä½œåŸç†

`gocov`ã¯ä»¥ä¸‹ã®æ‰‹é †ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é›†è¨ˆã—ã¾ã™ï¼š

1. æŒ‡å®šã•ã‚ŒãŸã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ
2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ãƒãƒ¬ãƒƒã‚¸æƒ…å ±ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ã§é›†è¨ˆ
3. ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆæ•°ã¨ã‚«ãƒãƒ¼ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆæ•°ã‚’è¨ˆç®—
4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç‡ã‚’ç®—å‡º
5. çµæœã‚’è¡¨å½¢å¼ã§å‡ºåŠ›

### ä¸¦è¡Œå‡¦ç†

`-concurrent`ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€å¤§è¦æ¨¡ãªã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ãŒé«˜é€ŸåŒ–ã•ã‚Œã¾ã™ï¼š

- 10ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸‹ã®å ´åˆã¯è‡ªå‹•çš„ã«é€šå¸¸ã®å‡¦ç†ã‚’ä½¿ç”¨
- 11ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸Šã®å ´åˆã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ä¸¦è¡Œå‡¦ç†
- æœ€å¤§4ã¤ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒåŒæ™‚ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†
- ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒå¢—ãˆã‚‹ã»ã©å‡¦ç†æ™‚é–“ã®çŸ­ç¸®åŠ¹æœãŒå¤§ãããªã‚Šã¾ã™

## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

- å¤§è¦æ¨¡ãªGoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç®¡ç†
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆJSONå‡ºåŠ›ã‚’æ´»ç”¨ï¼‰
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ã®ãƒ†ã‚¹ãƒˆå“è³ªã®å¯è¦–åŒ–
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä½ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç‰¹å®šï¼ˆ-minãƒ•ãƒ©ã‚°ã‚’æ´»ç”¨ï¼‰
- ãƒ†ã‚¹ãƒˆã‚„vendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é™¤å¤–ã—ãŸã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æï¼ˆ-ignoreãƒ•ãƒ©ã‚°ã‚’æ´»ç”¨ï¼‰
- PRãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®å¤‰æ›´éƒ¨åˆ†ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèªï¼ˆ-diffãƒ•ãƒ©ã‚°ã‚’æ´»ç”¨ï¼‰
- ã‚³ãƒŸãƒƒãƒˆå‰ã®æ–°è¦ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆä¸è¶³ãƒã‚§ãƒƒã‚¯ï¼ˆ-diff stagedã‚’æ´»ç”¨ï¼‰
- CIã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸å“è³ªã‚²ãƒ¼ãƒˆï¼ˆ-thresholdãƒ•ãƒ©ã‚°ã‚’æ´»ç”¨ï¼‰

## CI/CDã§ã®æ´»ç”¨ä¾‹

### GitHub Actionsã§ã®ä½¿ç”¨ä¾‹

```yaml
- name: Run tests with coverage
  run: go test -coverprofile=coverage.out -coverpkg=./... ./...

- name: Check overall coverage threshold
  run: |
    go install github.com/blck-snwmn/gocov@latest
    gocov -coverprofile=coverage.out -threshold 80

- name: Check PR diff coverage
  if: github.event_name == 'pull_request'
  run: |
    gocov -coverprofile=coverage.out -diff ${{ github.base_ref }} -threshold 70
```

### Pre-commitãƒ•ãƒƒã‚¯ã§ã®ä½¿ç”¨ä¾‹

```bash
#!/bin/bash
# .git/hooks/pre-commit

# Generate coverage
go test -coverprofile=coverage.out -coverpkg=./... ./... > /dev/null 2>&1

# Check staged changes coverage
gocov -coverprofile=coverage.out -diff staged

# Optional: fail if coverage is too low
# gocov -coverprofile=coverage.out -diff staged -threshold 60
```

## åˆ¶é™äº‹é …

- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯äº‹å‰ã«ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- å‡ºåŠ›å…ˆã¯æ¨™æº–å‡ºåŠ›ã®ã¿ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ä¿å­˜å¯èƒ½ï¼‰
- å·®åˆ†ã‚«ãƒãƒ¬ãƒƒã‚¸æ©Ÿèƒ½ã¯gitãƒªãƒã‚¸ãƒˆãƒªå†…ã§ã®ã¿å‹•ä½œã—ã¾ã™

## å¿…è¦è¦ä»¶

- Go 1.16ä»¥ä¸Š
- `golang.org/x/tools/cover`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- gitï¼ˆå·®åˆ†ã‚«ãƒãƒ¬ãƒƒã‚¸æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰